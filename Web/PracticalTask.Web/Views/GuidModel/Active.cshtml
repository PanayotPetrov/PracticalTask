@using PracticalTask.Common
@model PracticalTask.Web.ViewModels.GuidModel.GuidViewModelList;
@{
    this.ViewData["Title"] = "Active guid models";
}

<div class="container">
    <table class="table table-hover table-striped">
        <thead>
            <tr>
                <th scope="col">Guid number</th>
                <th scope="col">Status</th>
                <th scope="col">Created on</th>
                <th scope="col">Change status</th>
            </tr>
        </thead>
        <tbody>

            @foreach (var guidViewModel in Model.GuidViewModels)
            {
                <tr id="@guidViewModel.Id">
                    <td>@guidViewModel.Guid</td>
                    <td>@guidViewModel.Status</td>
                    <td>@guidViewModel.CreatedOn</td>
                    <td>@guidViewModel.ModifiedOn</td>
                    <td>
                        <button class="btn btn-success" onclick="ChangeStatus(@guidViewModel.Id)">
                            Change to ready to save
                        </button>
                    </td>
                </tr>

            }
        </tbody>
    </table>

</div>

<script>
    function ChangeStatus(id) {

        $.ajax({
            url: '/GuidModel/ChangeStatus',
            type: 'POST',
            data: JSON.stringify(id),
            contentType: 'application/json',
            success: function (result, status, xhr) {
                if (xhr.status == 200) {
                    $("#" + id).remove();
                }
            },
            error: function (xhr) {
                $("#modalLabel").text('Oops!');
                var errors = JSON.parse(xhr.responseText);
                for (var i = 0; i < errors.length; i++) {
                    $("#modalBody").append('<li class="text-danger">' + errors[i] + '</li>')
                }
                $("#exampleModal").modal('show')
            }
        });

        //$("#btnCloseModal").click(function () {
        //    $("#exampleModal").modal("hide");
        //    $("#modalBody").text('');
        //});
    }
</script>